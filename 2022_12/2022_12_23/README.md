# 2022_12_23

</br>

## 트랜젝션

</br>

### 트랜젝션 개념

데이터를 저장할 때 데이터베이스를 사용하는 이유는 트랜잭션이라는 개념을 지원하기 때문ㅇ

**트랜잭션**

-   데이터베이스에서 하나의 거래를 안전하게 처리하도록 보장해주는 것을 뜻함
-   5000원 계좌이체
    1.  A의 잔고를 5000원 감소
    2.  B의 잔고를 5000원 증가
    -   1번 성공후 2번에서 문제 터지면 A잔고에서 5000원 만 증발하는 심각한 문제가 발생함
    -   이러한 문제를 방지하기 위해 하나의 거래를 묶어서 처리해주는 트랜잭션이 등장
    -   DB 정상반영하게 해주는 Commit과 문제가 생겼을 때 되돌아가는 Rollback 지원\*\*

</br>

### <b>트랜잭션 ACID </b>

-   원자성 (Atomicity)
    -   트랜잭션 내에서 실행한 작업들은 마치 하나의 작업처럼 모두 성공하거나 실패해야함
-   일관성 (Consistency)
    -   모든 트랜잭션은 일관성있는 데이터베이스를 유지해야함 (ex-> DB에서 정한 무결성 제약조건을 항상 만족)
-   격리성 (Isolation)
    -   동시에 실행되는 트랜잭션들이 서로에게 영향을 미치지 않도록 격리한다
    -   동시에 같은 데이터를 수정하지 못하도록 해야한다
    -   격리성은 성능 이슈로 인해 트랜잭션 격리수준을 선택할 수 있다
-   지속성 (Durability)
    -   트랜잭션을 성공적으로 끝내면 그 결과가 항상 기록되어야함
    -   중간에 시스템 문제가 발생해도 데이터베이스 로그 등을 사용해서 성공한 트랜잭션 내용을 복구해야함

</br>

### <b>데이터베이스 연결 구조와 DB 세션</b>

**데이터베이스 연결 구조**

![image](https://user-images.githubusercontent.com/96561194/209260178-5a868250-7e75-480e-8fbb-02af0bde13d3.png)

-   클라이언트가 데이터베이스 서버에 연결을 요청하고 커넥션을 맺을 때 DB는 서버 내부에 세션이라는 것을 만듬
-   클라이언트를 통해 SQL을 전달하면 커넥션에 연결된 세션이 SQL을 실행함
-   세션은 트랜잭션을 시작하고, 커밋 또는 롤백을 통해 트랜잭션을 종료함
-   사용자가 커넥션을 닫거나, DBA가 세션을 강제로 종료하면 세션은 종료됨

</br>

### 트랜잭션 개념 이해

**트랜잭션 사용법**

-   데이터 변경쿼리를 실행하고 그 결과를 반영하려면 commit, 반영하고 싶지 않으면 rollback 호출
-   커밋을 호출하기 전까지는 임시로 데이터를 저장하는 것
    -   해당 트랜젝션을 시작한 세션(사용자) 에게만 변경 데이터가 보이고 다른 사용자에게는 보이지 않음
    -   해당 트랜잭션을 시작한 세션(사용자) 가 commit할 시 다른 사용자에게 보임
    -   rollback할시 해당 세션(사용자) 에게도 보이지 않음
-   기본은 자동 커밋으로 되어있다 트랜잭션을 사용하기 위해서는 수동 커밋으로 바꿔야함

```
set autocommit false; //수동 커밋 모드 설정
```
